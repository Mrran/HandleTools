package io.emqx.mqtt;

import io.emqx.mqtt.utis.MD5Utils;
import org.eclipse.paho.client.mqttv3.*;
import org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Scanner;


public class MyMqttSample5 {

    private final static String SECURE_ID = "test";
    private final static String SECURE_KEY = "test";
    private final static String PRODUCT_ID = "rvm-jlkj-k880";

    private final static String readPropertiesTopic = "/" + PRODUCT_ID + "/359420094530299/properties/read";

    private final static String writePropertiesTopic = "/" + PRODUCT_ID + "/359420094530299/properties/write";

    private final static String funcInvokeTopic = "/" + PRODUCT_ID + "/359420094530299/function/invoke";

    public static void main(String[] args) {

        startMockThread();

        String broker = "tcp://10.130.212.243:1883";
        String clientId = "359420096930298";
        MemoryPersistence persistence = new MemoryPersistence();
        MqttConnectOptions connOpts = new MqttConnectOptions();

        long timestamp = System.currentTimeMillis();
        //设置用户名
        String username = SECURE_ID + "|" + timestamp;
        connOpts.setUserName(username);

        //设置密码
        String password = MD5Utils.encrypt(SECURE_ID + "|" + timestamp + "|" + SECURE_KEY);
        connOpts.setPassword(password.toCharArray());

        try {
            MqttClient client = new MqttClient(broker, clientId, persistence);
            client.setCallback(new SampleCallback());

            //System.out.println("Connecting to broker: " + broker);
            IMqttToken iMqttToken = client.connectWithResult(connOpts);

            while (true){
                mockDataSend(client);
            }


//            client.disconnect();
//            client.close();
//            System.exit(0);
        } catch (MqttException me) {
            me.printStackTrace();
        }
    }

    private static void startMockThread() {
        new Thread(() -> {
            while (true){
                Scanner scanner = new Scanner(System.in);//2.构造一个“标准输入流”System.in关联的Scanner对象。
                System.out.println("请输入：");
                String s = scanner.nextLine();//3.读取输入
                try {
                    mockData = Integer.parseInt(s);
                }catch (Exception e){
                    e.printStackTrace();
                }

            }
        }).start();
    }

    /**
     * 1: 模拟 uu违停
     * 2、模拟 交通管制
     */
    public static int mockData = 1;


    private static void mockDataSend(MqttClient client) {

        try {
            String dataStr = "";
            String topic = "";
            if(mockData == 1){
                topic = readPropertiesTopic;
                long now = System.currentTimeMillis();
                dataStr = "{\"timestamp\":" + now + ",\"messageId\":\"111111111\",\"deviceId\":\"359420094530299\",\"properties\":[\"appVersion\",\"userConfig\"]}";
            }else if(mockData == 2){
                dataStr = "{\"msgType\":\"OBU\",\"data\":{\"HVMSG\":{\"sid\":\"07010136\",\"timeStamp\":1690443863916,\"sourceType\":0,\"vehicleType\":10,\"plateNo\":\"221207010136\",\"speed\":0,\"heading\":192.76,\"pos\":{\"latitude\":29.7264768,\"longitude\":106.5439936},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1.5,\"height\":0.75,\"length\":2.5},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{},\"ExteriorLights\":0},\"v2vEvent\":{},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":394},\"upstreamId\":{\"region\":5000,\"id\":195},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":174.78689575195312,\"roadType\":0}},\"RVMSG\":[{\"sid\":\"524\",\"timeStamp\":1690443863839,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":18,\"heading\":213.10000610351562,\"pos\":{\"latitude\":29.7290156,\"longitude\":106.536781,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"526\",\"timeStamp\":1690443863839,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":40,\"heading\":86,\"pos\":{\"latitude\":29.7291308,\"longitude\":106.5375028,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"相邻 同路段\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":394},\"upstreamId\":{\"region\":5000,\"id\":195},\"speedLimit\":70,\"currSpeed\":40,\"GPSStatus\":0,\"nodeDistance\":177.28317260742188,\"roadType\":0},\"v2vEvent\":{}}],\"RSIEvent\":[]}}";
            }else if(mockData == 3){
                dataStr = "{\"msgType\":\"OBU\",\"data\":{\"HVMSG\":{\"sid\":\"07010136\",\"timeStamp\":1690443949990,\"sourceType\":0,\"vehicleType\":10,\"plateNo\":\"221207010136\",\"speed\":33,\"heading\":134.7624969482422,\"pos\":{\"latitude\":29.7293696,\"longitude\":106.5438592},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1.5,\"height\":0.75,\"length\":2.5},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{},\"ExteriorLights\":0},\"v2vEvent\":{},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":199},\"upstreamId\":{\"region\":5000,\"id\":198},\"speedLimit\":70,\"currSpeed\":33,\"GPSStatus\":0,\"nodeDistance\":272.19561767578125,\"roadType\":0}},\"RVMSG\":[{\"sid\":\"CQA30137\",\"timeStamp\":1690443949894,\"sourceType\":0,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":11,\"heading\":355.88751220703125,\"pos\":{\"latitude\":29.7292518,\"longitude\":106.5441894,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1.5,\"height\":0,\"length\":5},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"205\",\"timeStamp\":1690443947752,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":0,\"heading\":280.3999938964844,\"pos\":{\"latitude\":29.7291631,\"longitude\":106.542125,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":-4.13042449951172,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"200\",\"timeStamp\":1690443947043,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":0,\"heading\":275.3999938964844,\"pos\":{\"latitude\":29.7291785,\"longitude\":106.542124,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":-5.840545654296875,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"904\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":29,\"heading\":119.69999694824219,\"pos\":{\"latitude\":29.729504,\"longitude\":106.5441176,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"827\",\"timeStamp\":1690443949913,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":0,\"heading\":264,\"pos\":{\"latitude\":29.7296347,\"longitude\":106.5441596,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"128\",\"timeStamp\":1690443949924,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":0,\"heading\":169.1999969482422,\"pos\":{\"latitude\":29.7263067,\"longitude\":106.5437575,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"831\",\"timeStamp\":1690443949913,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":4,\"heading\":264,\"pos\":{\"latitude\":29.7296976,\"longitude\":106.5441128,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"833\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":0,\"heading\":350.3999938964844,\"pos\":{\"latitude\":29.7293294,\"longitude\":106.5440573,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"旁边2 逆向\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":198},\"upstreamId\":{\"region\":5000,\"id\":199},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":2.394378662109375,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"842\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":0,\"heading\":263.70001220703125,\"pos\":{\"latitude\":29.7296113,\"longitude\":106.5441635,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"843\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":0,\"heading\":349.6000061035156,\"pos\":{\"latitude\":29.7293144,\"longitude\":106.5440947,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 逆向\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":198},\"upstreamId\":{\"region\":5000,\"id\":199},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":4.61553192138672,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"902\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":29,\"heading\":102,\"pos\":{\"latitude\":29.729533,\"longitude\":106.5442317,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":304},\"upstreamId\":{\"region\":5000,\"id\":198},\"speedLimit\":70,\"currSpeed\":29,\"GPSStatus\":0,\"nodeDistance\":762.7305908203125,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"198\",\"timeStamp\":1690443947141,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":4,\"heading\":290.3999938964844,\"pos\":{\"latitude\":29.7291634,\"longitude\":106.5421353,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":4,\"GPSStatus\":0,\"nodeDistance\":-4.183856964111328,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"202\",\"timeStamp\":1690443947752,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":4,\"heading\":275.3999938964844,\"pos\":{\"latitude\":29.7291779,\"longitude\":106.5421853,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":4,\"GPSStatus\":0,\"nodeDistance\":-5.893352508544922,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"856\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":0,\"heading\":264,\"pos\":{\"latitude\":29.729648,\"longitude\":106.5442756,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"209\",\"timeStamp\":1690443948785,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":4,\"heading\":353.29998779296875,\"pos\":{\"latitude\":29.7291811,\"longitude\":106.5421722,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":4,\"GPSStatus\":0,\"nodeDistance\":-6.223567962646484,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"207\",\"timeStamp\":1690443948176,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":0,\"heading\":280.3999938964844,\"pos\":{\"latitude\":29.729177,\"longitude\":106.5421823,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":-5.78744888305664,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"890\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":11,\"heading\":190.8000030517578,\"pos\":{\"latitude\":29.7293026,\"longitude\":106.5438271,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"旁边2 同路段\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":199},\"upstreamId\":{\"region\":5000,\"id\":198},\"speedLimit\":70,\"currSpeed\":11,\"GPSStatus\":0,\"nodeDistance\":264.9073486328125,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"206\",\"timeStamp\":1690443947935,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":0,\"heading\":275.3999938964844,\"pos\":{\"latitude\":29.7291555,\"longitude\":106.5421147,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":-3.2654266357421875,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"208\",\"timeStamp\":1690443948340,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":0,\"heading\":275.3999938964844,\"pos\":{\"latitude\":29.7291722,\"longitude\":106.5421789,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":-5.247188568115234,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"897\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":29,\"heading\":352.1000061035156,\"pos\":{\"latitude\":29.7300555,\"longitude\":106.5439709,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":305},\"upstreamId\":{\"region\":5000,\"id\":198},\"speedLimit\":70,\"currSpeed\":29,\"GPSStatus\":0,\"nodeDistance\":199.62246704101562,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"868\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":0,\"heading\":351.20001220703125,\"pos\":{\"latitude\":29.7293373,\"longitude\":106.544127,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":3,\"height\":4,\"length\":8},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 逆向\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":198},\"upstreamId\":{\"region\":5000,\"id\":199},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":2.4632949829101562,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"210\",\"timeStamp\":1690443949765,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":4,\"heading\":295.3999938964844,\"pos\":{\"latitude\":29.729162,\"longitude\":106.5421544,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":4,\"GPSStatus\":0,\"nodeDistance\":-4.065452575683594,\"roadType\":0},\"v2vEvent\":{\"eventStr\":\"FCW\",\"dir\":1,\"dirAngle\":0.01565755158662796,\"distanceV\":56.961875915527344,\"distanceH\":0.891956388950348,\"TTC\":5.07673692703247,\"act\":0}},{\"sid\":\"199\",\"timeStamp\":1690443946938,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":0,\"heading\":280.3999938964844,\"pos\":{\"latitude\":29.729161,\"longitude\":106.5421311,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":-3.9088516235351562,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"203\",\"timeStamp\":1690443947752,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":7,\"heading\":295.3999938964844,\"pos\":{\"latitude\":29.7291743,\"longitude\":106.5421185,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":7,\"GPSStatus\":0,\"nodeDistance\":-5.362895965576172,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"875\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":0,\"heading\":264,\"pos\":{\"latitude\":29.7296749,\"longitude\":106.5441636,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"195\",\"timeStamp\":1690443947141,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":4,\"heading\":242.39999389648438,\"pos\":{\"latitude\":29.7291773,\"longitude\":106.5421963,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":4,\"GPSStatus\":0,\"nodeDistance\":-5.848094940185547,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"906\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":25,\"heading\":264,\"pos\":{\"latitude\":29.7296426,\"longitude\":106.544498,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"905\",\"timeStamp\":1690443949914,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":0,\"heading\":81,\"pos\":{\"latitude\":29.729606,\"longitude\":106.5436333,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"相邻 未知\"},\"ExteriorLights\":0},\"roadInfo\":{},\"v2vEvent\":{}},{\"sid\":\"957\",\"timeStamp\":1690443949925,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":0,\"heading\":180.8000030517578,\"pos\":{\"latitude\":29.7269341,\"longitude\":106.5440439,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 同路段\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":199},\"upstreamId\":{\"region\":5000,\"id\":198},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":-0.5982666015625,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"958\",\"timeStamp\":1690443949925,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":18,\"heading\":180,\"pos\":{\"latitude\":29.7272731,\"longitude\":106.5440847,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 同路段\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":199},\"upstreamId\":{\"region\":5000,\"id\":198},\"speedLimit\":70,\"currSpeed\":18,\"GPSStatus\":0,\"nodeDistance\":39.19258117675781,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"201\",\"timeStamp\":1690443947248,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":0,\"heading\":280.3999938964844,\"pos\":{\"latitude\":29.7291639,\"longitude\":106.5421263,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":-4.22189712524414,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"204\",\"timeStamp\":1690443947427,\"sourceType\":4,\"vehicleType\":82,\"plateNo\":\"\",\"speed\":0,\"heading\":275.3999938964844,\"pos\":{\"latitude\":29.7291671,\"longitude\":106.5421165,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":1,\"height\":2,\"length\":1},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 未知\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":197},\"upstreamId\":{\"region\":5000,\"id\":303},\"speedLimit\":70,\"currSpeed\":0,\"GPSStatus\":0,\"nodeDistance\":-4.5585479736328125,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"959\",\"timeStamp\":1690443949925,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":22,\"heading\":180,\"pos\":{\"latitude\":29.7270095,\"longitude\":106.5440773,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 同路段\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":199},\"upstreamId\":{\"region\":5000,\"id\":198},\"speedLimit\":70,\"currSpeed\":22,\"GPSStatus\":0,\"nodeDistance\":9.61552429199219,\"roadType\":0},\"v2vEvent\":{}},{\"sid\":\"960\",\"timeStamp\":1690443949925,\"sourceType\":4,\"vehicleType\":10,\"plateNo\":\"\",\"speed\":25,\"heading\":180,\"pos\":{\"latitude\":29.7272101,\"longitude\":106.5441186,\"elevation\":0},\"angle\":0,\"transmission\":0,\"accelSet\":{\"lon\":0,\"lat\":0,\"vert\":0,\"yaw\":0},\"size\":{\"width\":2.5,\"height\":2,\"length\":4},\"brakeSystemStatus\":{},\"safetyExt\":{\"VehicleEventFlags\":{},\"PathHistory\":{},\"PathPrediction\":{\"a\":\"未知 同路段\"},\"ExteriorLights\":0},\"roadInfo\":{\"nodeId\":{\"region\":5000,\"id\":199},\"upstreamId\":{\"region\":5000,\"id\":198},\"speedLimit\":70,\"currSpeed\":25,\"GPSStatus\":0,\"nodeDistance\":32.593223571777344,\"roadType\":0},\"v2vEvent\":{}}],\"RSIEvent\":[{\"eventStr\":\"IVS\",\"rsiId\":\"rsu13093202\",\"distance\":24.391265869140625,\"alertRadius\":0,\"eventValue\":0,\"arrivalTime\":0,\"alertType\":88,\"description\":\"6e6f2064616e6765726f7573\",\"pos\":{\"latitude\":29.729151,\"longitude\":106.54388,\"elevation\":0},\"alertPath\":[{\"latitude\":29.729356,\"longitude\":106.543896,\"elevation\":0},{\"latitude\":29.726935,\"longitude\":106.544058,\"elevation\":0},{\"latitude\":29.721601,\"longitude\":106.542764,\"elevation\":0}]},{\"eventStr\":\"IVS\",\"rsiId\":\"rsu13010201\",\"distance\":24.391265869140625,\"alertRadius\":0,\"eventValue\":0,\"arrivalTime\":0,\"alertType\":88,\"description\":\"6e6f2064616e6765726f7573\",\"pos\":{\"latitude\":29.729151,\"longitude\":106.54388,\"elevation\":0},\"alertPath\":[{\"latitude\":29.729356,\"longitude\":106.543896,\"elevation\":0},{\"latitude\":29.726935,\"longitude\":106.544058,\"elevation\":0},{\"latitude\":29.721601,\"longitude\":106.542764,\"elevation\":0}]}]}}";
            }

            MqttMessage message = new MqttMessage(dataStr.getBytes());
            message.setQos(0);
            client.publish(topic, message);

            System.out.println("topic = " + topic + ", dataStr = " + dataStr);

            Thread.sleep(10000);

        } catch (Exception e) {
            e.printStackTrace();
        }


    }

}
